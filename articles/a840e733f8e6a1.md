---
title: "TypeScript, PostgreSQL, Next.js, Prisma & GraphQLをつかってフルスタックAppを作る"
emoji: "🦔"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["TypeScript", "PostgreSQL", "Next.js", "Prisma", "GraphQL"]
published: false
---

:::message
本記事は、[@thisismahmoud_](https://twitter.com/thisismahmoud_)氏による「[Fullstack App With TypeScript, PostgreSQL, Next.js, Prisma & GraphQL: Data Modeling](https://www.prisma.io/blog/fullstack-nextjs-graphql-prisma-oklidw1rhw)」の日本語翻訳を、Prismaから許可を得て掲載しているものです。※画像やリンクは公式のBlogからお借りしています。
:::

![](https://storage.googleapis.com/zenn-user-upload/e0f2c9ef3f57-20220416.png)

この記事は、Next.js, GraphQL, TypeScript, Prisma, PostgreSQLを使ってフルスタックアプリを構築する講座の第1部です。この記事では、データモデルを作成し、Prismaのさまざまなコンポーネントを探ります。

# はじめに

このコースでは、ユーザーがキュレーションされたリンクのリストを閲覧し、お気に入りのリンクをブックマークできるフルスタックアプリ「awesome-links」を構築する方法を学びます。

https://www.youtube.com/watch?v=hZgFAO4_t4Q

アプリは以下の技術で構築されています。

- Next.js：Reactフレームワークとして
- Apollo Server：GraphQLサーバーとして
- Nexus：GraphQLスキーマを構築する
- Apollo Client：GraphQLクライアント 
- Prisma ：マイグレーションとデータベースアクセスのためのORMである
- PostgreSQL：データベースは 
- AWS S3：画像アップロード用 
- Auth0：認証のための 
- TypeScript：プログラミング言語 
- TailwindCSS：ユーティリティ優先のCSSフレームワーク 
- Vercel：デプロイメント用

## コースで扱う内容
- Prismaを用いたデータモデリング 
- Apollo ServerとNexusを使ったNext.js APIルートのGraphQL APIレイヤーの構築 
- Apolloクライアントを使用したGraphQLのページネーション 
- Auth0を用いた認証 
- 認証 
- AWS S3による画像アップロード 
- Vercelへのデプロイメント

## 今日学べること
本講座の第1回では、まずアプリの要件定義と、Prismaを使ったデータベース層の設定を行います。

# 前提条件
https://www.youtube.com/watch?v=cwg2Vv0rJCo

## 想定される知識
このコースは、以下を前提としています。

- Node.jsの基本的な知識

- リレーショナルデータベースの基本的な理解 このコースに参加する前にデータベースについてもっと学びたい方は、Prismaのデータガイドでデータベースの仕組み、正しいデータベースの選び方、アプリケーションでデータベースを最大限に活用する方法について詳しく学んでください。
- Next.jsを使用するため、Reactの知識があることを強く推奨します。

このコースでは必要ありません。

- TypeScriptの知識（すでにJavaScriptの経験があることを前提とします
- Prismaの知識は、本講座で説明します。

最後に、このコースではデータベースとしてPostgreSQLを使用しますが、ほとんどのコンセプトはMySQLなど他のリレーショナルデータベースにも適用できます。

この記事の終わりには、データベースに接続されたNext.jsアプリが完成していることでしょう。

## 開発環境

このコースに従うには、あなたのマシンにNode.jsがインストールされている必要があります。また、PostgreSQLのインスタンスが動作している必要があります。

:::message
注：PostgreSQLはローカルに設定するか、Herokuにホスティングインスタンスを作成することができます。コースの最後のデプロイメントステップでは、リモートデータベースが必要であることに注意してください。
:::

https://www.youtube.com/watch?v=7ihvEtBAjRY

# リポジトリのクローン
この[コースの完全なソースコード](https://github.com/m-abdelwahab/awesome-links)は、GitHubで見ることができます。

:::message
注：各記事には対応するブランチがあり、順を追って読むことができるようになっています。part-1 ブランチをチェックアウトすることで、この記事と同じスタート地点に立つことができます。まず、好きなディレクトリに移動して、以下のコマンドを実行してリポジトリをクローンします。
:::

```shell
git clone -b part-1 https://github.com/m-abdelwahab/awesome-links.git
```

クローンしたディレクトリに移動して、依存関係をインストールし、開発サーバーを起動することができます。

```shell
cd awesome-links
npm install
npm run dev
```

スタータープロジェクトはこんな感じです。

![](https://storage.googleapis.com/zenn-user-upload/905d1cc430d2-20220416.png)

## プロジェクトの構成と依存関係を見る

```
awesome-links/
┣ components/
┃ ┗ Layout/
┣ data/
┃ ┗ links.ts
┣ pages/
┃ ┣ _app.tsx
┃ ┣ about.tsx
┃ ┗ index.tsx
┣ public/
┣ styles/
┃ ┗ tailwind.css
┣ .gitignore
┣ README.md
┣ next-env.d.ts
┣ next.config.js
┣ package-lock.json
┣ package.json
┣ postcss.config.js
┣ tailwind.config.js
┗ tsconfig.json
```

https://www.youtube.com/watch?v=4cpqSOQKSo8

このスタータープロジェクトは、TypeScriptとTailwindCSSをインストールしたNext.jsのアプリです。

Next.jsはフルスタックのReactフレームワークで、さまざまなデータ取得ストラテジーをサポートしています。ひとつはサーバーサイドレンダリングで、リクエストごとにデータをフェッチします。また、ビルド時にデータをフェッチして、CDNで提供できる静的なウェブサイトを用意することもできます。このアプリでは、サーバーサイドでデータを取得することになります。

Next.jsではファイルベースのルーティングを使用しており、pagesディレクトリ内の各ファイルがルートとなります。現在、http://localhost:3000 にインデックスページがあり、http://localhost:3000/about にアバウトページがあります。

_app.tsxファイルは、デフォルトのAppの動作をオーバーライドするために使用されます。このファイルでは、ページ変更時のレイアウトを保持したり、グローバルCSSを追加したりすることができます。

```tsx
// pages/_app.tsx

import '../styles/tailwind.css' // import Tailwind globally
import { Layout } from '../components/Layout' // header layout persists between page changes
function MyApp({ Component, pageProps }) {
  return (
    <Layout>
      <Component {...pageProps} />
    </Layout>
  )
}
export default MyApp
```

http://localhost:3000 にナビゲートするときに見るデータは、/data/links.ts ファイルにハードコードされています。今後のパートでは、データはGraphQL APIを使用してデータベースから動的に取得される予定です。

