---
title: "Next.jsã§ã€Œã“ã®ã‚µã‚¤ãƒˆã‚’é›¢ã‚Œã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹?è¡Œã£ãŸå¤‰æ›´ãŒä¿å­˜ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã€ã®å®Ÿç¾ã‚’ã™ã‚‹"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React", "Next.js", "TypeScript"]
published: false
---

## ã‚„ã‚ŠãŸã„ã“ã¨

![](https://storage.googleapis.com/zenn-user-upload/6e11011e6eae-20220906.png)

ã“ã‚Œã‚’å®Ÿç¾ã—ãŸã„ã¨ãã®æ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

## çµè«–

```tsx: useBeforeUnloadAlert.tsx
import React from 'react';

import { useRouter } from 'next/router';

// https://github.com/vercel/next.js/issues/2476#issuecomment-563190607
export const useBeforeUnloadAlert = (message: string): void => {
  const router = useRouter();

  const pageChangeHandler = React.useCallback(() => {
    const answer = window.confirm(message);
    if (!answer) {
      throw 'Abort route';
    }
  }, [message]);

  const beforeUnloadhandler = React.useCallback(
    (event) => {
      event.returnValue = message;
    },
    [message]
  );

  React.useEffect(() => {
    router.events.on('routeChangeStart', pageChangeHandler);
    window.addEventListener('beforeunload', beforeUnloadhandler);
    return () => {
      router.events.off('routeChangeStart', pageChangeHandler);
      window.removeEventListener('beforeunload', beforeUnloadhandler);
    };
  }, [beforeUnloadhandler, pageChangeHandler, router]);
};
```

ã“ã®ã‚ˆã†ã«ã€ã‚«ã‚¹ã‚¿ãƒ hooksã‚’ä½œã£ã¦ã€

```tsx
// å‘¼ã³ãŸã„å ´æ‰€ã§
useBeforeUnloadAlert('è‡ªåˆ†ã§è¨­å®šã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã™ã‚‹');
```

ã“ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ã€‚


## æ³¨æ„

æœ¬å½“ã¯ã€ç”»é¢é·ç§»ã®éš›ã«ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‡ºã—ãŸã„ã®ã§ã™ãŒã€
ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‹ã¨ãã«ã€æ„å›³ã›ã¬ã‚¢ãƒ©ãƒ¼ãƒˆãŒå‡ºã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ãã®æ™‚ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒãƒƒã‚¯ã‚’ã™ã‚‹ã¨å›é¿ã§ãã¾ã™ã€‚

```tsx
<a href="somefile.txt" download target="_blank">Download</a>
```

`download`ã¨`target="_blank"`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒãƒƒã‚¯çš„ã«å›é¿ã§ãã¾ã™ã€‚

## å‚è€ƒ
https://stackoverflow.com/questions/54662104/make-download-link-not-trigger-beforeunload/54662178#54662178

https://github.com/vercel/next.js/issues/2476
